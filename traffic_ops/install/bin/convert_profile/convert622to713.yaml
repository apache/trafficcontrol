---
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

description: Upgrade profile from ATS6 to ATS7 based on https://cwiki.apache.org/confluence/display/TS/Upgrading+to+v7.0
replace_name:
  old: '621'
  new: '713'
replace_description:
  old: v6.2.1
  new: v7.1.3
validate_parameters:
- name: trafficserver
  config_file: package
  value: 6.2.1-62.3f63b3a.el7.centos.x86_64
conversion_actions:
- match_parameter:
    name: trafficserver
    config_file: package
    value: 6.2.1-62.3f63b3a.el7.centos.x86_64
  new_value: "<PLACE TRAFFICSERVER7 VERSION STRING HERE>"
- match_parameter:
    name: trafficserver-debuginfo
    config_file: package
    value: 6.2.1-62.3f63b3a.el7.centos.x86_64
  new_value: "<PLACE TRAFFICSERVER7 VERSION STRING HERE>"
- match_parameter:
    name: location
    config_file: logs_xml\.config
    value: ".*"
  new_config_file: logging.config
- match_parameter:
    name: LogFormat\.*
    config_file: logs_xml\.config
    value: ".*"
  new_config_file: logging.config
- match_parameter:
    name: CONFIG proxy\.config\.log\.xml_config_file
    config_file: records\.config
    value: STRING logs_xml\.config
  new_name: CONFIG proxy.config.log.config.filename
  new_value: STRING logging.confxsig
- match_parameter:
    name: CONFIG proxy\.config\.hostdb\.timeout
    config_file: records\.config
    value: INT 1440
  new_value: INT 86400
- match_parameter:
    name: CONFIG proxy\.config\.http\.keep_alive_no_activity_timeout_in
    config_file: records\.config
    value: INT 115
  new_value: INT 120
- match_parameter:
    name: CONFIG proxy\.config\.http\.cache\.fuzz\.time
    config_file: records\.config
    value: INT 240
  new_value: INT 0
- match_parameter:
    name: CONFIG proxy\.config\.http\.cache\.fuzz\.probability
    config_file: records\.config
    value: FLOAT 0.005
  new_value: INT 0
- match_parameter:
    name: CONFIG proxy\.config\.http\.anonymize_insert_client_ip
    config_file: records\.config
    value: ".*"
  new_name: CONFIG proxy.config.http.insert_client_ip
- match_parameter:
    name: CONFIG proxy\.node\.num_processes
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.ssl\.compression
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.ssl\.number\.threads
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.system\.mmap_max
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.stats\.enable_lua
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.hostdb\.size
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.hostdb\.storage_size
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.ping\.npack_to_trans
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.ping\.timeout_sec
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.http\.enable_url_expandomatic
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.dns\.url_expansions
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.ssl\.SSLv2
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.icp\..*
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.config\.spdy\..*
    config_file: records\.config
    value: ".*"
  action: delete
- match_parameter:
    name: CONFIG proxy\.cluster\..*
    config_file: records\.config
    value: ".*"
  action: delete

